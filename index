<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hesap Makinesi, Gizli Galeri, Not Defteri ve √á√∂p Kutusu</title>
    <style>
        /* CSS kodlarƒ± burada deƒüi≈ümedi, eski halini koruyor */
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        h1, p, h2 {
            color: #ffffff;
            text-align: center;
        }
        .calculator, .secret-container, .notes-page, .trash-page {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            text-align: center;
            display: none;
            max-width: 800px;
            margin: 20px auto;
        }
        .calculator {
            display: block; /* Hesap makinesi ba≈ülangƒ±√ßta a√ßƒ±k */
        }
        input[type="number"], input[type="file"], input[type="text"] {
            padding: 10px;
            margin: 10px 5px;
            border: 1px solid #333;
            border-radius: 4px;
            width: 80px;
            background-color: #2d2d2d;
            color: white;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            max-width: 300px;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .result {
            margin-top: 10px;
            font-size: 1.2em;
            color: #ffffff;
            min-height: 24px;
        }
        .gallery-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        .gallery-item {
            position: relative;
            width: 200px;
            height: 200px;
            overflow: hidden;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding-bottom: 30px;
            box-sizing: border-box;
        }
        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
        }
        .gallery-item img, .gallery-item video {
            width: 100%;
            height: calc(100% - 30px);
            object-fit: cover;
        }
        .gallery-item video {
            object-fit: contain;
            background-color: #000;
        }
        .gallery-item .video-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            color: rgba(255,255,255,0.7);
            text-shadow: 0 0 5px black;
            pointer-events: none;
        }

        .gallery-item .file-name {
            position: absolute;
            bottom: 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.8em;
            padding: 5px 0;
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            box-sizing: border-box;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
            z-index: 10;
        }

        .gallery-item:hover .delete-btn,
        .folder-item:hover .delete-btn {
            opacity: 1;
        }

        .fullscreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }
        .fullscreen img, .fullscreen video {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            margin-bottom: 20px;
        }
        .fullscreen a {
            display: block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .close-btn, .prev-btn, .next-btn {
            position: absolute;
            background-color: rgba(0, 123, 255, 0.7);
            color: #ffffff;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            z-index: 1010;
        }
        .close-btn {
            top: 20px;
            right: 20px;
            transform: none;
        }
        .prev-btn {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        .next-btn {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        .close-btn:hover, .prev-btn:hover, .next-btn:hover {
            background-color: #0056b3;
        }

        /* Not Defteri Sayfasƒ± Stilleri */
        .notes-page h2 {
            color: #ffffff;
            margin-bottom: 15px;
        }
        #noteText {
            width: calc(100% - 20px);
            max-width: 760px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #2d2d2d;
            color: white;
            font-size: 1em;
            resize: vertical;
        }
        .notes-page button {
            background-color: #28a745;
        }
        .notes-page button:hover {
            background-color: #218838;
        }
        .notes-page button[onclick="closeNotesPage()"] {
            background-color: #6c757d;
        }
        .notes-page button[onclick="closeNotesPage()"]:hover {
            background-color: #5a6268;
        }

        /* √á√∂p Kutusu Sayfasƒ± Stilleri */
        .trash-page {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            text-align: center;
            display: none;
            max-width: 800px;
            margin: 20px auto;
        }
        .trash-page h2 {
            color: #ffffff;
            margin-bottom: 15px;
        }
        .trash-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            min-height: 100px;
            border: 1px dashed #444;
            padding: 10px;
            border-radius: 5px;
        }
        .trash-item {
            position: relative;
            width: 150px;
            height: 150px;
            overflow: hidden;
            border: 1px solid #555;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 5px;
            box-sizing: border-box;
            background-color: #2a2a2a;
        }
        .trash-item img, .trash-item video {
            max-width: 100%;
            max-height: calc(100% - 40px);
            object-fit: cover;
        }
        .trash-item .file-name {
            font-size: 0.7em;
            color: #ccc;
            margin-top: 5px;
            word-break: break-all;
            text-align: center;
        }
        .trash-item .trash-actions {
            margin-top: 5px;
            display: flex;
            gap: 5px;
        }
        .trash-item .trash-actions button {
            padding: 5px 8px;
            font-size: 0.7em;
            margin: 0;
            border-radius: 3px;
        }
        .trash-item .restore-btn {
            background-color: #007bff;
        }
        .trash-item .restore-btn:hover {
            background-color: #0056b3;
        }
        .trash-item .permanent-delete-btn {
            background-color: #dc3545;
        }
        .trash-item .permanent-delete-btn:hover {
            background-color: #c82333;
        }
        .trash-page button {
            margin: 5px;
        }
        .trash-page button[onclick="clearTrash()"] {
            background-color: #dc3545;
        }
        .trash-page button[onclick="clearTrash()"]:hover {
            background-color: #c82333;
        }
        .trash-page button[onclick="closeTrashPage()"] {
            background-color: #6c757d;
        }
        .trash-page button[onclick="closeTrashPage()"]:hover {
            background-color: #5a6268;
        }

        /* Klas√∂r g√∂r√ºn√ºm√º i√ßin stiller */
        .folder-item {
            position: relative;
            width: 200px;
            height: 200px;
            border: 2px solid #555;
            border-radius: 8px;
            background-color: #333;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }
        .folder-item:hover {
            transform: scale(1.05);
            background-color: #444;
        }
        .folder-icon {
            font-size: 4em;
            margin-bottom: 10px;
            color: #ffc107; /* Sarƒ± klas√∂r ikonu */
        }
        .current-folder-path {
            text-align: left;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #aaa;
            width: 100%;
            padding-left: 10px;
            box-sizing: border-box;
        }
        .folder-actions {
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            input[type="number"], input[type="file"], input[type="text"] {
                width: 100%;
                margin: 5px 0;
            }
            .gallery-item, .trash-item, .folder-item {
                width: calc(50% - 15px);
                height: 150px;
            }
            button {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            #noteText {
                width: calc(100% - 20px);
            }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Hesap Makinesi</h1>
        <input type="number" id="num1" placeholder="Sayƒ± 1">
        <input type="number" id="num2" placeholder="Sayƒ± 2">
        <div>
            <button onclick="calculate('add')">+</button>
            <button onclick="calculate('subtract')">-</button>
            <button onclick="calculate('multiply')">√ó</button>
            <button onclick="calculate('divide')">√∑</button>
        </div>
        <div class="result" id="result">Sonu√ß: </div>
    </div>

    <div class="secret-container">
        <h1>Gizli Galeri</h1>
        <div class="current-folder-path" id="currentFolderPath">Konum: K√∂k Dizin</div>
        <div class="folder-actions">
            <input type="text" id="newFolderName" placeholder="Yeni klas√∂r adƒ±">
            <button onclick="createFolder()">Klas√∂r Olu≈ütur</button>
            <button onclick="goBackFolder()" id="goBackFolderBtn" style="display: none;">Geri Git</button>
        </div>
        <p>Dosyalarƒ±nƒ±zƒ± buradan y√ºkleyin ve d√ºzenli bir ≈üekilde g√∂r√ºn!</p>
        <input type="file" id="fileInput" accept="image/*,video/*,.pdf,.doc,.docx,.txt,.zip,.rar" multiple>
        <button onclick="uploadFilesToCurrentFolder()">Dosyalarƒ± Y√ºkle</button>
        <button onclick="clearGallery()">Galeriyi Temizle</button>
        <div class="gallery-container" id="galleryContainer"></div>

        <button onclick="openNotesPage()" style="margin-top: 15px;">Not Defterini A√ß</button>
        <button onclick="openTrashPage()" style="margin-top: 15px; background-color: #ffc107; color: black;">√á√∂p Kutusunu A√ß</button>

        <div class="fullscreen" id="fullscreen">
        </div>

        <button onclick="logout()">√áƒ±kƒ±≈ü</button>
    </div>

    <div id="notesPage" class="notes-page">
        <h2>Not Defteri</h2>
        <textarea id="noteText" placeholder="Notunuzu buraya yazƒ±n..." rows="10"></textarea>
        <button onclick="saveNote()">Notu Kaydet</button>
        <div class="result" id="noteResult"></div>
        <button onclick="closeNotesPage()" style="margin-top: 20px;">Geri</button>
    </div>

    <div id="trashPage" class="trash-page">
        <h2>√á√∂p Kutusu</h2>
        <div class="trash-container" id="trashContainer"></div>
        <button onclick="clearTrash()" style="background-color: #dc3545; margin-top: 20px;">√á√∂p Kutusunu Bo≈üalt</button>
        <button onclick="closeTrashPage()" style="margin-top: 20px;">Geri</button>
    </div>

    <script>
        const secretNumber1 = 1;
        const secretNumber2 = 42;
        let photos = [];
        let folders = [];
        let currentFolderId = null;
        let trashedFiles = [];
        let currentPhotoIndex = 0;
        let savedNote = "";

        // IndexedDB Ayarlarƒ±
        const DB_NAME = 'SecretAppData';
        const DB_VERSION = 2;
        const GALLERY_STORE_NAME = 'galleryFiles';
        const FOLDER_STORE_NAME = 'folders';
        const TRASH_STORE_NAME = 'trashStore';
        let db;

        // IndexedDB'yi Ba≈ülatma Fonksiyonu
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = (event) => {
                    console.error("IndexedDB hatasƒ±:", event.target.errorCode);
                    reject('IndexedDB a√ßƒ±lamadƒ±.');
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log("IndexedDB ba≈üarƒ±yla a√ßƒ±ldƒ±.");
                    resolve();
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(GALLERY_STORE_NAME)) {
                        const galleryStore = db.createObjectStore(GALLERY_STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        galleryStore.createIndex('folderId', 'folderId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(FOLDER_STORE_NAME)) {
                        const folderStore = db.createObjectStore(FOLDER_STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        folderStore.createIndex('parentFolderId', 'parentFolderId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(TRASH_STORE_NAME)) {
                        db.createObjectStore(TRASH_STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    }
                    console.log("Object stores olu≈üturuldu/g√ºncellendi.");
                };
            });
        }

        // IndexedDB'den t√ºm dosyalarƒ± veya klas√∂rleri getirme (belirli bir store'dan)
        function getAllItems(storeName, indexName = null, indexValue = null) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('IndexedDB hen√ºz ba≈ülatƒ±lmadƒ±.');
                    return;
                }
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                let request;

                if (indexName && (indexValue !== undefined && indexValue !== null)) {
                    const index = store.index(indexName);
                    request = index.getAll(IDBKeyRange.only(indexValue));
                } else if (indexName && (indexValue === undefined || indexValue === null)) {
                    // Bu kƒ±sƒ±m null veya undefined olan indexValue'lar i√ßin doƒüru √ßalƒ±≈ümalƒ±
                    // Yani parentFolderId'si null olan klas√∂rler (k√∂k dizin) veya folderId'si null olan dosyalar
                    request = store.getAll(); // T√ºm √∂ƒüeleri √ßekip manuel filtreleyeceƒüiz
                } else {
                    request = store.getAll();
                }

                request.onsuccess = (event) => {
                    let results = event.target.result;
                    // Eƒüer indexName var ama indexValue null/undefined ise, manuel filtrele
                    if (indexName && (indexValue === null || indexValue === undefined)) {
                         results = results.filter(item => item[indexName] === null || item[indexName] === undefined);
                    }
                    resolve(results);
                };

                request.onerror = (event) => {
                    console.error(`√ñƒüeler ${storeName} store'dan alƒ±nƒ±rken hata:`, event.target.errorCode);
                    reject(`√ñƒüeler ${storeName} store'dan alƒ±namadƒ±.`);
                };
            });
        }

        // IndexedDB'ye dosya veya klas√∂r ekleme
        function addItem(storeName, itemObj) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('IndexedDB hen√ºz ba≈ülatƒ±lmadƒ±.');
                    return;
                }
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                let itemToAdd = { ...itemObj };

                // ID'yi number'a √ßeviriyoruz ki tutarlƒ± olsun
                if (itemToAdd.id && typeof itemToAdd.id === 'string') {
                    itemToAdd.id = parseInt(itemToAdd.id, 10);
                }
                if (itemToAdd.folderId && typeof itemToAdd.folderId === 'string') {
                    itemToAdd.folderId = parseInt(itemToAdd.folderId, 10);
                }
                if (itemToAdd.parentFolderId && typeof itemToAdd.parentFolderId === 'string') {
                    itemToAdd.parentFolderId = parseInt(itemToAdd.parentFolderId, 10);
                }

                const request = store.add(itemToAdd);

                request.onsuccess = (event) => {
                    resolve(event.target.result);
                };

                request.onerror = (event) => {
                    console.error(`√ñƒüe ${storeName} store'a eklenirken hata:`, event.target.errorCode, itemToAdd);
                    reject(`√ñƒüe ${storeName} store'a eklenemedi.`);
                };
            });
        }

        // IndexedDB'den dosya veya klas√∂r silme (ID ile)
        function deleteItemFromDB(storeName, id) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('IndexedDB hen√ºz ba≈ülatƒ±lmadƒ±.');
                    return;
                }
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);

                request.onsuccess = () => {
                    resolve();
                };

                request.onerror = (event) => {
                    console.error(`√ñƒüe ${storeName} store'dan silinirken hata:`, event.target.errorCode);
                    reject(`√ñƒüe ${storeName} store'dan silinemedi.`);
                };
            });
        }

        // IndexedDB'deki bir store'u temizleme
        function clearStore(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject('IndexedDB hen√ºz ba≈ülatƒ±lmadƒ±.');
                    return;
                }
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.clear();

                request.onsuccess = () => {
                    resolve();
                };

                request.onerror = (event) => {
                    console.error(`Store ${storeName} temizlenirken hata:`, event.target.errorCode);
                    reject(`Store ${storeName} temizlenemedi.`);
                };
            });
        }


        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await initIndexedDB();
                await loadGalleryContent();
                trashedFiles = await getAllItems(TRASH_STORE_NAME);
            } catch (error) {
                console.error("Uygulama ba≈ülatƒ±lƒ±rken hata:", error);
                alert("Veritabanƒ± ba≈ülatƒ±lƒ±rken bir sorun olu≈ütu.");
            }

            const storedNote = localStorage.getItem('userNote');
            if (storedNote) {
                savedNote = storedNote;
                document.getElementById('noteText').value = savedNote;
            }
        });

        // Galerinin i√ßeriƒüini (klas√∂rler ve dosyalar) y√ºkleme fonksiyonu
        async function loadGalleryContent() {
            // currentFolderId null ise, parentFolderId'si null olanlarƒ± getir (k√∂k dizindeki klas√∂rler)
            // folderId null ise, klas√∂rlere ait olmayan dosyalarƒ± getir (k√∂k dizindeki dosyalar)
            
            // Buradaki await'ler √ßok √∂nemli, verilerin tamamen √ßekildiƒüinden emin olmalƒ±yƒ±z.
            photos = await getAllItems(GALLERY_STORE_NAME, 'folderId', currentFolderId);
            folders = await getAllItems(FOLDER_STORE_NAME, 'parentFolderId', currentFolderId);
            
            renderGallery();
            updateFolderPathDisplay();
        }

        // Klas√∂r yolunu g√ºncelleme fonksiyonu
        async function updateFolderPathDisplay() {
            const pathDisplay = document.getElementById('currentFolderPath');
            const goBackBtn = document.getElementById('goBackFolderBtn');
            if (currentFolderId === null) {
                pathDisplay.textContent = "Konum: K√∂k Dizin";
                goBackBtn.style.display = 'none';
            } else {
                const allFolders = await getAllItems(FOLDER_STORE_NAME);
                let path = [];
                let tempFolderId = currentFolderId;

                while (tempFolderId !== null) {
                    // ID'lerin tipini Number olarak kontrol et
                    const folder = allFolders.find(f => f.id === parseInt(tempFolderId, 10));
                    if (folder) {
                        path.unshift(folder.name);
                        tempFolderId = folder.parentFolderId;
                    } else {
                        console.warn(`[updateFolderPathDisplay] Klas√∂r ID ${tempFolderId} bulunamadƒ±. K√∂k dizine d√∂n√ºl√ºyor.`);
                        // Klas√∂r bulunamazsa, k√∂k dizine d√∂nerek g√∂r√ºnt√º tutarsƒ±zlƒ±ƒüƒ±nƒ± gider.
                        currentFolderId = null;
                        await loadGalleryContent(); // Tekrar y√ºkle
                        return; // Fonksiyondan √ßƒ±k
                    }
                }
                pathDisplay.textContent = `Konum: K√∂k Dizin ${path.length > 0 ? '> ' + path.join(' > ') : ''}`;
                goBackBtn.style.display = 'inline-block';
            }
        }


        function calculate(operation) {
            const num1 = parseFloat(document.getElementById('num1').value);
            const num2 = parseFloat(document.getElementById('num2').value);
            const resultElement = document.getElementById('result');

            if (isNaN(num1) || isNaN(num2)) {
                resultElement.textContent = "L√ºtfen ge√ßerli sayƒ±lar girin.";
                return;
            }

            let result;
            switch (operation) {
                case 'add':
                    result = num1 + num2;
                    if (num1 === secretNumber1 && num2 === secretNumber2) {
                        openSecretContainer();
                        return;
                    }
                    break;
                case 'subtract':
                    result = num1 - num2;
                    break;
                case 'multiply':
                    result = num1 * num2;
                    break;
                case 'divide':
                    if (num2 === 0) {
                        resultElement.textContent = "Bir sayƒ± sƒ±fƒ±ra b√∂l√ºnemez!";
                        return;
                    }
                    result = num1 / num2;
                    break;
                default:
                    result = "Ge√ßersiz i≈ülem.";
            }
            resultElement.textContent = `Sonu√ß: ${result}`;
        }

        function openSecretContainer() {
            document.querySelector('.calculator').style.display = 'none';
            document.getElementById('notesPage').style.display = 'none';
            document.getElementById('fullscreen').style.display = 'none';
            document.getElementById('trashPage').style.display = 'none';

            document.querySelector('.secret-container').style.display = 'block';
            currentFolderId = null; // Her giri≈üte k√∂k dizine d√∂n
            loadGalleryContent();
        }

        function logout() {
            document.querySelector('.secret-container').style.display = 'none';
            document.getElementById('notesPage').style.display = 'none';
            document.getElementById('fullscreen').style.display = 'none';
            document.getElementById('trashPage').style.display = 'none';

            document.querySelector('.calculator').style.display = 'block';
            document.getElementById('num1').value = '';
            document.getElementById('num2').value = '';
            document.getElementById('result').textContent = 'Sonu√ß: ';
        }

        // Klas√∂r olu≈üturma fonksiyonu
        async function createFolder() {
            const newFolderName = document.getElementById('newFolderName').value.trim();
            if (!newFolderName) {
                alert("L√ºtfen bir klas√∂r adƒ± girin.");
                return;
            }

            const allFoldersInCurrent = await getAllItems(FOLDER_STORE_NAME, 'parentFolderId', currentFolderId);
            const existingFolder = allFoldersInCurrent.find(f => f.name === newFolderName); 
            if (existingFolder) {
                alert("Bu klas√∂rde bu isimde bir klas√∂r zaten var. L√ºtfen farklƒ± bir isim girin.");
                return;
            }

            try {
                await addItem(FOLDER_STORE_NAME, { name: newFolderName, parentFolderId: currentFolderId });
                document.getElementById('newFolderName').value = '';
                await loadGalleryContent();
                alert(`'${newFolderName}' klas√∂r√º olu≈üturuldu.`);
            } catch (error) {
                console.error("Klas√∂r olu≈üturulurken hata:", error);
                alert("Klas√∂r olu≈üturulurken bir hata olu≈ütu.");
            }
        }

        // Klas√∂re gitme fonksiyonu
        async function openFolder(folderId) {
            currentFolderId = folderId;
            await loadGalleryContent();
        }

        // Bir √ºst klas√∂re geri d√∂nme fonksiyonu
        async function goBackFolder() {
            if (currentFolderId === null) {
                alert("Zaten k√∂k dizindesiniz.");
                return;
            }
            const allFolders = await getAllItems(FOLDER_STORE_NAME);
            // currentFolderId'nin number tipinde olduƒüundan emin ol
            const current = allFolders.find(f => f.id === parseInt(currentFolderId, 10)); 
            if (current) {
                currentFolderId = current.parentFolderId;
                await loadGalleryContent();
            } else {
                console.warn(`[goBackFolder] Mevcut Klas√∂r ID ${currentFolderId} bulunamadƒ±. K√∂k dizine d√∂n√ºl√ºyor.`);
                currentFolderId = null;
                await loadGalleryContent();
            }
        }

        // Dosyalarƒ± mevcut klas√∂re y√ºkleme fonksiyonu
        async function uploadFilesToCurrentFolder() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;

            if (files.length === 0) {
                alert("L√ºtfen bir veya daha fazla dosya se√ßin.");
                return;
            }

            try {
                const fileReaders = Array.from(files).map(file => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve({
                            dataURL: e.target.result,
                            type: file.type,
                            name: file.name,
                            folderId: currentFolderId // Ensure this is stored as a number or null
                        });
                        reader.onerror = (error) => reject(error);
                        reader.readAsDataURL(file);
                    });
                });

                const results = await Promise.all(fileReaders);
                for (const fileObj of results) {
                    await addItem(GALLERY_STORE_NAME, fileObj);
                }
                await loadGalleryContent();
                alert('Dosyalar ba≈üarƒ±yla y√ºklendi!');
            } catch (error) {
                console.error("Dosya y√ºklenirken bir hata olu≈ütu:", error);
                alert('Dosya y√ºklenirken bir hata olu≈ütu. Konsolu kontrol edin.');
            } finally {
                fileInput.value = '';
            }
        }

        // Galeriyi temizle (mevcut klas√∂rdeki t√ºm √∂ƒüeleri √ß√∂p kutusuna ta≈üƒ±)
        async function clearGallery() {
            if (photos.length === 0 && folders.length === 0) {
                alert('Bu klas√∂r zaten bo≈ü.');
                return;
            }
            if (confirm('Bu klas√∂rdeki t√ºm dosyalarƒ± ve alt klas√∂rleri (i√ßindekilerle birlikte) √ß√∂p kutusuna ta≈üƒ±mak istediƒüinize emin misiniz?')) {
                try {
                    // Mevcut klas√∂rdeki dosyalarƒ± √ß√∂p kutusuna ta≈üƒ±
                    for (const item of photos) {
                        const itemForTrash = { ...item };
                        delete itemForTrash.id; 
                        itemForTrash.originalId = item.id; 
                        itemForTrash.isFolder = false; 
                        await addItem(TRASH_STORE_NAME, itemForTrash);
                        await deleteItemFromDB(GALLERY_STORE_NAME, item.id);
                    }
                    // Mevcut klas√∂rdeki alt klas√∂rleri √ß√∂p kutusuna ta≈üƒ± (ve i√ßindekileri sil)
                    for (const folder of folders) {
                        await deleteFolderRecursive(folder.id);
                    }

                    await loadGalleryContent(); // Sayfayƒ± tamamen yenile
                    alert('Bu klas√∂rdeki t√ºm √∂ƒüeler √ß√∂p kutusuna ta≈üƒ±ndƒ±.');
                } catch (error) {
                    console.error("Galeriyi temizlerken bir hata olu≈ütu:", error);
                    alert("Galeriyi temizlerken bir hata olu≈ütu.");
                }
            }
        }

        // renderGallery fonksiyonu IndexedDB ve Klas√∂r uyumlu
        function renderGallery() {
            const galleryContainer = document.getElementById('galleryContainer');
            galleryContainer.innerHTML = '';

            if (folders.length === 0 && photos.length === 0) {
                galleryContainer.innerHTML = '<p style="width:100%; text-align:center; padding: 20px;">Bu klas√∂rde hen√ºz klas√∂r veya dosya bulunamadƒ±.</p>';
            }

            // Klas√∂rleri g√∂ster
            folders.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.classList.add('folder-item');
                folderItem.innerHTML = `
                    <div class="folder-icon">üìÅ</div>
                    <span class="file-name">${folder.name}</span>
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteFolder(${folder.id})">√ó</button>
                `;
                folderItem.onclick = () => openFolder(folder.id);
                galleryContainer.appendChild(folderItem);
            });

            // Dosyalarƒ± g√∂ster
            photos.forEach((fileObj, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.classList.add('gallery-item');

                let contentElement;
                if (fileObj.type.startsWith('image/')) {
                    contentElement = document.createElement('img');
                    contentElement.src = fileObj.dataURL;
                    contentElement.alt = fileObj.name;
                } else if (fileObj.type.startsWith('video/')) {
                    contentElement = document.createElement('video');
                    contentElement.src = fileObj.dataURL;
                    contentElement.alt = fileObj.name;
                    contentElement.controls = false;
                    contentElement.muted = true;
                    contentElement.autoplay = true;
                    contentElement.loop = true;

                    const videoIcon = document.createElement('div');
                    videoIcon.classList.add('video-icon');
                    videoIcon.textContent = '‚ñ∂';
                    galleryItem.appendChild(videoIcon);

                } else {
                    contentElement = document.createElement('img');
                    contentElement.src = 'https://via.placeholder.com/200x200?text=Dosya';
                    contentElement.alt = 'Genel Dosya';
                    contentElement.style.objectFit = 'contain';
                    contentElement.style.backgroundColor = '#3498db';
                    if (fileObj.type === 'application/pdf') {
                        contentElement.src = 'https://via.placeholder.com/200x200?text=PDF';
                        contentElement.alt = 'PDF Dosyasƒ±';
                        contentElement.style.backgroundColor = '#f40f02';
                    }
                }
                galleryItem.appendChild(contentElement);

                const fileNameSpan = document.createElement('span');
                fileNameSpan.classList.add('file-name');
                fileNameSpan.textContent = fileObj.name;
                galleryItem.appendChild(fileNameSpan);

                const deleteBtn = document.createElement('button');
                deleteBtn.classList.add('delete-btn');
                deleteBtn.innerHTML = '√ó';

                deleteBtn.onclick = async (e) => {
                    e.stopPropagation();
                    await deletePhoto(fileObj.id);
                };

                galleryItem.appendChild(deleteBtn);
                galleryContainer.appendChild(galleryItem);

                galleryItem.addEventListener('click', () => openFullscreen(fileObj.id));
            });
            updateFolderPathDisplay();
        }

        // Klas√∂r√º silme (i√ßindekileri √ß√∂p kutusuna ta≈üƒ±ma)
        async function deleteFolder(folderIdToDelete) {
            console.log(`[deleteFolder] Silinmek istenen Klas√∂r ID: ${folderIdToDelete}`);
            // ID'nin number olduƒüundan emin olalƒ±m
            const parsedFolderIdToDelete = parseInt(folderIdToDelete, 10); 

            const allFolders = await getAllItems(FOLDER_STORE_NAME);
            const folderToDelete = allFolders.find(f => f.id === parsedFolderIdToDelete); 

            if (!folderToDelete) {
                console.log(`[deleteFolder] Klas√∂r bulunamadƒ±: ${parsedFolderIdToDelete}. Muhtemelen zaten silinmi≈ü veya ID yanlƒ±≈ü.`);
                alert("Silinmek istenen klas√∂r bulunamadƒ±. Sayfayƒ± yenileyip tekrar deneyin.");
                await loadGalleryContent(); 
                return;
            }

            if (confirm(`'${folderToDelete.name}' klas√∂r√ºn√º ve i√ßindeki t√ºm dosyalarƒ±/alt klas√∂rleri √ß√∂p kutusuna ta≈üƒ±mak istediƒüinize emin misiniz?`)) {
                try {
                    console.log(`[deleteFolder] Ba≈ülatƒ±lƒ±yor: deleteFolderRecursive(${parsedFolderIdToDelete})`);
                    await deleteFolderRecursive(parsedFolderIdToDelete);
                    
                    console.log(`[deleteFolder] deleteFolderRecursive tamamlandƒ±. √á√∂p kutusu ve galeri g√ºncelleniyor.`);
                    trashedFiles = await getAllItems(TRASH_STORE_NAME);
                    await loadGalleryContent(); // √ñnemli: Galeriyi yeniden y√ºkle
                    alert(`'${folderToDelete.name}' klas√∂r√º ve i√ßindekiler √ß√∂p kutusuna ta≈üƒ±ndƒ±.`);
                    console.log(`[deleteFolder] ƒ∞≈ülem Ba≈üarƒ±lƒ±: ${folderToDelete.name} √ß√∂p kutusuna ta≈üƒ±ndƒ±.`);
                } catch (error) {
                    console.error("[deleteFolder] Klas√∂r silinirken hata:", error);
                    alert("Klas√∂r silinirken bir hata olu≈ütu.");
                }
            }
        }

        // Alt klas√∂rleri ve dosyalarƒ±nƒ± √∂zyinelemeli silme (√ß√∂p kutusuna ta≈üƒ±ma)
        async function deleteFolderRecursive(folderId) {
            console.log(`[deleteFolderRecursive] ƒ∞≈üleniyor Klas√∂r ID: ${folderId}`);

            // ID'nin number olduƒüundan emin olalƒ±m
            const parsedFolderId = parseInt(folderId, 10);

            const filesInFolder = await getAllItems(GALLERY_STORE_NAME, 'folderId', parsedFolderId);
            console.log(`[deleteFolderRecursive] Klas√∂r ${parsedFolderId} i√ßindeki dosyalar (${filesInFolder.length}):`, filesInFolder.map(f => f.name));

            const subFolders = await getAllItems(FOLDER_STORE_NAME, 'parentFolderId', parsedFolderId);
            console.log(`[deleteFolderRecursive] Klas√∂r ${parsedFolderId} i√ßindeki alt klas√∂rler (${subFolders.length}):`, subFolders.map(f => f.name));

            // Dosyalarƒ± √ß√∂p kutusuna ta≈üƒ± ve galeriden sil
            for (const file of filesInFolder) {
                console.log(`[deleteFolderRecursive] Dosya √ß√∂p kutusuna ta≈üƒ±nƒ±yor ve galeriden siliniyor: ${file.name} (ID: ${file.id})`);
                const fileForTrash = { ...file };
                delete fileForTrash.id; 
                fileForTrash.originalId = file.id; 
                fileForTrash.isFolder = false; 
                await addItem(TRASH_STORE_NAME, fileForTrash);
                await deleteItemFromDB(GALLERY_STORE_NAME, file.id);
            }

            // Alt klas√∂rleri ve onlarƒ±n i√ßindekileri √∂zyinelemeli olarak sil
            for (const subFolder of subFolders) {
                console.log(`[deleteFolderRecursive] Alt klas√∂r i≈üleniyor (√∂zyinelemeli): ${subFolder.name} (ID: ${subFolder.id})`);
                await deleteFolderRecursive(subFolder.id);
            }

            // En son olarak, mevcut klas√∂r√ºn kendisini √ß√∂p kutusuna ta≈üƒ± ve klas√∂rlerden sil
            // Dikkat: Burada 'allFolders' yerine doƒürudan 'folderId' ile aramalƒ±yƒ±z √ß√ºnk√º
            // bu fonksiyon Recursive (√∂zyinelemeli) √ßalƒ±≈ütƒ±ƒüƒ± i√ßin, alt klas√∂rler zaten silinmi≈ü olabilir.
            const folderToDeleteItself = (await getAllItems(FOLDER_STORE_NAME)).find(f => f.id === parsedFolderId);

            if (folderToDeleteItself) {
                console.log(`[deleteFolderRecursive] Klas√∂r√ºn kendisi √ß√∂p kutusuna ta≈üƒ±nƒ±yor ve klas√∂rlerden siliniyor: ${folderToDeleteItself.name} (ID: ${folderToDeleteItself.id})`);
                const folderForTrash = { ...folderToDeleteItself };
                delete folderForTrash.id; 
                folderForTrash.originalId = folderToDeleteItself.id; 
                folderForTrash.isFolder = true; 
                await addItem(TRASH_STORE_NAME, folderForTrash);
                await deleteItemFromDB(FOLDER_STORE_NAME, parsedFolderId); // Doƒüru ID'yi kullan
            } else {
                console.log(`[deleteFolderRecursive] Klas√∂r ${parsedFolderId} zaten FOLDER_STORE_NAME'de yoktu (muhtemelen recursive √ßaƒürƒ± sƒ±rasƒ±nda silindi).`);
            }
            console.log(`[deleteFolderRecursive] Klas√∂r ${parsedFolderId} i≈üleme tamamlandƒ±.`);
        }


        // deletePhoto fonksiyonu IndexedDB i√ßin g√ºncellendi
        async function deletePhoto(idToDelete) {
            if (confirm('Bu dosyayƒ± √ß√∂p kutusuna ta≈üƒ±mak istediƒüinize emin misiniz?')) {
                try {
                    // ID'nin number olduƒüundan emin olalƒ±m
                    const parsedIdToDelete = parseInt(idToDelete, 10);

                    const allPhotos = await getAllItems(GALLERY_STORE_NAME);
                    const fileToTrash = allPhotos.find(file => file.id === parsedIdToDelete); 
                    if (fileToTrash) {
                        const fileForTrash = { ...fileToTrash };
                        delete fileForTrash.id; 
                        fileForTrash.originalId = fileToTrash.id; 
                        fileForTrash.isFolder = false; 
                        await addItem(TRASH_STORE_NAME, fileForTrash);
                        await deleteItemFromDB(GALLERY_STORE_NAME, parsedIdToDelete);
                        
                        trashedFiles = await getAllItems(TRASH_STORE_NAME); // √á√∂p kutusunu g√ºncelledik
                        await loadGalleryContent(); // Galeriyi g√ºncelledik
                        alert('Dosya √ß√∂p kutusuna ta≈üƒ±ndƒ±.');
                    } else {
                        alert('Dosya bulunamadƒ±.');
                        await loadGalleryContent(); 
                    }
                } catch (error) {
                    console.error("Dosyayƒ± √ß√∂p kutusuna ta≈üƒ±rken hata:", error);
                    alert("Dosyayƒ± √ß√∂p kutusuna ta≈üƒ±rken bir hata olu≈ütu.");
                }
            }
        }

        // openFullscreen fonksiyonu IndexedDB uyumlu
        function openFullscreen(fileId) {
            currentPhotoIndex = photos.findIndex(p => p.id === parseInt(fileId, 10)); 
            if (currentPhotoIndex === -1) {
                alert("Dosya bulunamadƒ±.");
                return;
            }
            const fullscreen = document.getElementById('fullscreen');
            
            fullscreen.innerHTML = '';

            const closeBtn = document.createElement('button');
            closeBtn.classList.add('close-btn');
            closeBtn.textContent = 'Kapat';
            closeBtn.onclick = closeFullscreen;

            const prevBtn = document.createElement('button');
            prevBtn.classList.add('prev-btn');
            prevBtn.textContent = '‚Üê';
            prevBtn.onclick = prevPhoto;

            const nextBtn = document.createElement('button');
            nextBtn.classList.add('next-btn');
            nextBtn.textContent = '‚Üí';
            nextBtn.onclick = nextPhoto;

            fullscreen.appendChild(closeBtn);
            fullscreen.appendChild(prevBtn);
            fullscreen.appendChild(nextBtn);

            const fileObj = photos[currentPhotoIndex];

            if (fileObj.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = fileObj.dataURL;
                img.alt = fileObj.name;
                fullscreen.appendChild(img);
            } else if (fileObj.type.startsWith('video/')) {
                const video = document.createElement('video');
                video.src = fileObj.dataURL;
                video.alt = fileObj.name;
                video.controls = true;
                video.autoplay = true;
                video.loop = false;
                fullscreen.appendChild(video);
            } else {
                const fileDisplay = document.createElement('div');
                fileDisplay.style.color = 'white';
                fileDisplay.style.textAlign = 'center';
                fileDisplay.style.fontSize = '1.5em';
                fileDisplay.style.maxWidth = '90%';
                fileDisplay.style.wordBreak = 'break-all';
                fileDisplay.innerHTML = `<p><strong>${fileObj.name}</strong></p><p>(${fileObj.type})</p>`;

                const downloadLink = document.createElement('a');
                downloadLink.href = fileObj.dataURL;
                downloadLink.download = fileObj.name;
                downloadLink.textContent = 'Dosyayƒ± ƒ∞ndir';
                downloadLink.style.display = 'inline-block';
                downloadLink.style.marginTop = '20px';
                downloadLink.style.padding = '10px 20px';
                downloadLink.style.backgroundColor = '#007BFF';
                downloadLink.style.color = 'white';
                downloadLink.style.textDecoration = 'none';
                downloadLink.style.borderRadius = '5px';
                fileDisplay.appendChild(downloadLink);

                fullscreen.appendChild(fileDisplay);
            }

            fullscreen.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeFullscreen() {
            const fullscreen = document.getElementById('fullscreen');
            fullscreen.style.display = 'none';
            document.body.style.overflow = 'auto';
            const videoElement = fullscreen.querySelector('video');
            if (videoElement) {
                videoElement.pause();
                videoElement.currentTime = 0;
            }
        }

        function prevPhoto() {
            if (photos.length === 0) return;
            currentPhotoIndex = (currentPhotoIndex - 1 + photos.length) % photos.length;
            openFullscreen(photos[currentPhotoIndex].id);
        }

        function nextPhoto() {
            if (photos.length === 0) return;
            currentPhotoIndex = (currentPhotoIndex + 1) % photos.length;
            openFullscreen(photos[currentPhotoIndex].id);
        }

        // Not Defteri Fonksiyonlarƒ±
        function openNotesPage() {
            document.querySelector('.calculator').style.display = 'none';
            document.querySelector('.secret-container').style.display = 'none';
            document.getElementById('trashPage').style.display = 'none';
            document.getElementById('notesPage').style.display = 'block';
            document.getElementById('noteText').value = savedNote;
        }

        function closeNotesPage() {
            document.getElementById('notesPage').style.display = 'none';
            document.querySelector('.secret-container').style.display = 'block';
        }

        function saveNote() {
            savedNote = document.getElementById('noteText').value;
            localStorage.setItem('userNote', savedNote);
            document.getElementById('noteResult').textContent = "Not kaydedildi!";
            setTimeout(() => {
                document.getElementById('noteResult').textContent = "";
            }, 2000);
        }

        // √á√∂p Kutusu Fonksiyonlarƒ±
        async function openTrashPage() {
            document.querySelector('.calculator').style.display = 'none';
            document.querySelector('.secret-container').style.display = 'none';
            document.getElementById('notesPage').style.display = 'none';
            document.getElementById('trashPage').style.display = 'block';
            await renderTrash();
        }

        function closeTrashPage() {
            document.getElementById('trashPage').style.display = 'none';
            document.querySelector('.secret-container').style.display = 'block';
        }

        async function renderTrash() {
            const trashContainer = document.getElementById('trashContainer');
            trashContainer.innerHTML = '';
            trashedFiles = await getAllItems(TRASH_STORE_NAME); // En g√ºncel √ß√∂p kutusu i√ßeriƒüini al

            if (trashedFiles.length === 0) {
                trashContainer.innerHTML = '<p style="width:100%; text-align:center; padding: 20px;">√á√∂p kutusu bo≈ü.</p>';
                return;
            }

            trashedFiles.forEach(item => {
                const trashItem = document.createElement('div');
                trashItem.classList.add('trash-item');

                let previewElement;
                if (item.isFolder) {
                    previewElement = document.createElement('div');
                    previewElement.classList.add('folder-icon');
                    previewElement.textContent = 'üìÅ';
                    previewElement.style.fontSize = '3em';
                    previewElement.style.marginBottom = '5px';
                    previewElement.style.color = '#ffc107';

                } else if (item.type && item.type.startsWith('image/')) {
                    previewElement = document.createElement('img');
                    previewElement.src = item.dataURL;
                    previewElement.alt = item.name;
                } else if (item.type && item.type.startsWith('video/')) {
                    previewElement = document.createElement('video');
                    previewElement.src = item.dataURL;
                    previewElement.alt = item.name;
                    previewElement.controls = false;
                    previewElement.muted = true;
                    previewElement.autoplay = true;
                    previewElement.loop = true;
                    previewElement.style.width = '100%';
                    previewElement.style.height = '100%';
                    previewElement.style.objectFit = 'contain';
                    previewElement.style.backgroundColor = 'black';
                } else {
                    previewElement = document.createElement('img');
                    previewElement.src = 'https://via.placeholder.com/100x100?text=Dosya';
                    previewElement.alt = 'Genel Dosya';
                    previewElement.style.objectFit = 'contain';
                    previewElement.style.backgroundColor = '#3498db';
                    if (item.type === 'application/pdf') {
                        previewElement.src = 'https://via.placeholder.com/100x100?text=PDF';
                        previewElement.alt = 'PDF Dosyasƒ±';
                        previewElement.style.backgroundColor = '#f40f02';
                    }
                }
                trashItem.appendChild(previewElement);

                const fileNameSpan = document.createElement('span');
                fileNameSpan.classList.add('file-name');
                fileNameSpan.textContent = item.name;
                trashItem.appendChild(fileNameSpan);

                const actionsDiv = document.createElement('div');
                actionsDiv.classList.add('trash-actions');

                const restoreBtn = document.createElement('button');
                restoreBtn.classList.add('restore-btn');
                restoreBtn.textContent = 'Geri Y√ºkle';
                restoreBtn.onclick = () => restoreFromTrash(item.id, item.isFolder);
                actionsDiv.appendChild(restoreBtn);

                const permanentDeleteBtn = document.createElement('button');
                permanentDeleteBtn.classList.add('permanent-delete-btn');
                permanentDeleteBtn.textContent = 'Kalƒ±cƒ± Sil';
                permanentDeleteBtn.onclick = () => permanentDelete(item.id, item.isFolder);
                actionsDiv.appendChild(permanentDeleteBtn);

                trashItem.appendChild(actionsDiv);
                trashContainer.appendChild(trashItem);
            });
        }

        async function restoreFromTrash(idToRestore, isFolder = false) {
            if (confirm('Bu √∂ƒüeyi galerisine geri y√ºklemek istediƒüinize emin misiniz?')) {
                try {
                    // ID'nin number olduƒüundan emin olalƒ±m
                    const parsedIdToRestore = parseInt(idToRestore, 10);

                    const itemToRestore = trashedFiles.find(item => item.id === parsedIdToRestore);
                    if (itemToRestore) {
                        const restoredItem = { ...itemToRestore };
                        delete restoredItem.id; 
                        
                        let targetFolderExists = false;
                        if (isFolder) { 
                            if (restoredItem.parentFolderId === null || restoredItem.parentFolderId === undefined) {
                                targetFolderExists = true; 
                            } else {
                                const allFolders = await getAllItems(FOLDER_STORE_NAME);
                                targetFolderExists = allFolders.some(f => f.id === parseInt(restoredItem.parentFolderId, 10));
                            }
                        } else { 
                            if (restoredItem.folderId === null || restoredItem.folderId === undefined) {
                                targetFolderExists = true; 
                            } else {
                                const allFolders = await getAllItems(FOLDER_STORE_NAME);
                                targetFolderExists = allFolders.some(f => f.id === parseInt(restoredItem.folderId, 10));
                            }
                        }

                        if (!targetFolderExists) {
                            alert("Geri y√ºklenecek klas√∂r veya √ºst klas√∂r bulunamadƒ±. √ñƒüeyi k√∂k dizine y√ºkl√ºyorum.");
                            if (isFolder) {
                                restoredItem.parentFolderId = null;
                            } else {
                                restoredItem.folderId = null;
                            }
                        }

                        if (isFolder) {
                            await addItem(FOLDER_STORE_NAME, restoredItem);
                        } else {
                            await addItem(GALLERY_STORE_NAME, restoredItem);
                        }
                        await deleteItemFromDB(TRASH_STORE_NAME, parsedIdToRestore);

                        await renderTrash(); // √á√∂p kutusunu yeniden √ßiz
                        await loadGalleryContent(); // Galeriyi yeniden y√ºkle
                        alert('√ñƒüe ba≈üarƒ±yla geri y√ºklendi.');
                    } else {
                        alert('√ñƒüe √ß√∂p kutusunda bulunamadƒ±.');
                    }
                } catch (error) {
                    console.error("√ñƒüe geri y√ºklenirken hata:", error);
                    alert("√ñƒüe geri y√ºklenirken bir hata olu≈ütu.");
                }
            }
        }

        async function permanentDelete(idToDelete, isFolder = false) {
            if (confirm('Bu √∂ƒüeyi kalƒ±cƒ± olarak silmek istediƒüinize emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                try {
                    // ID'nin number olduƒüundan emin olalƒ±m
                    const parsedIdToDelete = parseInt(idToDelete, 10);

                    const itemToDeleteInTrash = trashedFiles.find(item => item.id === parsedIdToDelete);

                    if (!itemToDeleteInTrash) {
                        console.warn(`[permanentDelete] √á√∂p kutusunda ${parsedIdToDelete} ID'li √∂ƒüe bulunamadƒ±.`);
                        alert('√ñƒüe √ß√∂p kutusunda bulunamadƒ±.');
                        await renderTrash(); // √á√∂p kutusunu g√ºncelleyelim
                        return;
                    }

                    if (isFolder) {
                        // Bir klas√∂r kalƒ±cƒ± olarak silinirken, √ß√∂p kutusundaki alt √∂ƒüeleri de silmeliyiz.
                        // Dikkat: Burada `itemToDeleteInTrash.originalId` kullanƒ±lƒ±r, √ß√ºnk√º bu, klas√∂r√ºn orijinal ID'sidir.
                        // `deleteAllItemsInFolderPermanently` zaten √ß√∂p kutusundaki orijinal ID'leri bulup siliyor.
                        await deleteAllItemsInFolderPermanently(parsedIdToDelete); // `deleteAllItemsInFolderPermanently` fonksiyonunu g√ºncelledik.
                    } else {
                        await deleteItemFromDB(TRASH_STORE_NAME, parsedIdToDelete);
                    }
                    
                    await renderTrash(); // √á√∂p kutusunu g√ºncelledik
                    alert('√ñƒüe kalƒ±cƒ± olarak silindi.');
                } catch (error) {
                    console.error("√ñƒüe kalƒ±cƒ± olarak silinirken hata:", error);
                    alert("√ñƒüe kalƒ±cƒ± olarak silinirken bir hata olu≈ütu.");
                }
            }
        }
        
        async function deleteAllItemsInFolderPermanently(trashItemId) {
            // √á√∂p kutusundaki bu klas√∂r objesini bul
            const folderInTrash = (await getAllItems(TRASH_STORE_NAME)).find(item => item.id === parseInt(trashItemId, 10) && item.isFolder);

            if (!folderInTrash) {
                console.warn(`[deleteAllItemsInFolderPermanently] √á√∂p kutusunda ${trashItemId} ID'li klas√∂r bulunamadƒ±.`);
                return;
            }
            
            const originalFolderId = folderInTrash.originalId;

            // Orijinal klas√∂r ID'sine ait dosyalarƒ± ve alt klas√∂rleri bul
            const allTrashedItems = await getAllItems(TRASH_STORE_NAME);

            // Bu orijinal klas√∂re ait t√ºm alt √∂ƒüeleri (dosyalar ve alt klas√∂rler) bul ve sil
            // Dikkat: Burada `originalId`'ye g√∂re filtreleme yapƒ±yoruz, √ß√ºnk√º `folderId` ve `parentFolderId`
            // orijinal ID'leri tutuyor.
            const itemsToDeleteUnderThisFolder = allTrashedItems.filter(item => {
                // Eƒüer bir dosya ise ve folderId'si orijinal klas√∂r ID'sine e≈üitse
                if (!item.isFolder && item.folderId === originalFolderId) {
                    return true;
                }
                // Eƒüer bir klas√∂r ise ve parentFolderId'si orijinal klas√∂r ID'sine e≈üitse
                if (item.isFolder && item.parentFolderId === originalFolderId) {
                    return true;
                }
                return false;
            });


            for (const item of itemsToDeleteUnderThisFolder) {
                if (item.isFolder) {
                    console.log(`[deleteAllItemsInFolderPermanently] Alt klas√∂r kalƒ±cƒ± olarak siliniyor (√∂zyinelemeli): ${item.name} (√á√∂p ID: ${item.id}, Orijinal ID: ${item.originalId})`);
                    // Alt klas√∂r√º de √∂zyinelemeli olarak sil
                    await deleteAllItemsInFolderPermanently(item.id); 
                } else {
                    console.log(`[deleteAllItemsInFolderPermanently] Dosya kalƒ±cƒ± olarak siliniyor: ${item.name} (√á√∂p ID: ${item.id}, Orijinal ID: ${item.originalId})`);
                    await deleteItemFromDB(TRASH_STORE_NAME, item.id);
                }
            }
            
            // Son olarak, klas√∂r√ºn kendisini √ß√∂p kutusundan sil
            console.log(`[deleteAllItemsInFolderPermanently] Ana klas√∂r kalƒ±cƒ± olarak siliniyor: ${folderInTrash.name} (√á√∂p ID: ${folderInTrash.id}, Orijinal ID: ${folderInTrash.originalId})`);
            await deleteItemFromDB(TRASH_STORE_NAME, folderInTrash.id);
        }


        async function clearTrash() {
            if (trashedFiles.length === 0) {
                alert('√á√∂p kutusu zaten bo≈ü.');
                return;
            }
            if (confirm('√á√∂p kutusundaki t√ºm √∂ƒüeleri kalƒ±cƒ± olarak silmek istediƒüinize emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                try {
                    await clearStore(TRASH_STORE_NAME);
                    trashedFiles = [];
                    await renderTrash();
                    alert('√á√∂p kutusu ba≈üarƒ±yla bo≈üaltƒ±ldƒ±.');
                } catch (error) {
                    console.error("√á√∂p kutusu bo≈üaltƒ±lƒ±rken hata:", error);
                    alert("√á√∂p kutusu bo≈üaltƒ±lƒ±rken bir hata olu≈ütu.");
                }
            }
        }

    </script>
</body>
</html>
